---
phase: 15-custom-dropdowns
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/components/ui/Select.tsx
  - app/src/components/ShareDialog.tsx
  - app/src/components/FormRenderer.tsx
  - app/src/components/FieldEditor.tsx
  - app/src/components/FormBuilder.tsx
  - app/src/app/style-guide/page.tsx
autonomous: false
---

<objective>
Create a premium custom Select component and replace all native HTML selects throughout the app.

Purpose: Deliver a polished, brand-consistent dropdown experience that elevates the editorial aesthetic. Native selects look generic and break the carefully crafted visual language.

Output: Reusable Select component with search, keyboard navigation, and smooth animations. All 5 native select instances replaced.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
@~/.claude/get-shit-done/skills/frontend-design/SKILL.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-custom-dropdowns/15-CONTEXT.md
@.planning/phases/13-brand-foundation/13-01-SUMMARY.md

# Existing patterns to follow:
@app/src/components/ui/Input.tsx

# Files to modify:
@app/src/components/ShareDialog.tsx
@app/src/components/FormRenderer.tsx
@app/src/components/FieldEditor.tsx
@app/src/components/FormBuilder.tsx
@app/src/app/style-guide/page.tsx

# Brand tokens:
@app/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Select component</name>
  <files>app/src/components/ui/Select.tsx</files>
  <wireframe>
Closed state:
+----------------------------------+
| Selected value              [v]  |
+----------------------------------+

Open state (standard):
+----------------------------------+
| Selected value              [^]  |
+----------------------------------+
| Option 1                         |
| Option 2 (highlighted)           |
| Option 3                         |
+----------------------------------+

Open state (searchable, when options > 5):
+----------------------------------+
| Search...                   [x]  |
+----------------------------------+
| Matching option 1                |
| Matching option 2 (highlighted)  |
| Matching option 3                |
+----------------------------------+
  </wireframe>
  <action>
Create Select component following Input.tsx patterns:

**API Design:**
```typescript
interface SelectOption {
  value: string;
  label: string;
}

interface SelectProps {
  options: SelectOption[];
  value?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  label?: string;
  error?: string;
  hint?: string;
  disabled?: boolean;
  searchable?: boolean | "auto"; // "auto" enables search when options > 5
  inputSize?: "sm" | "md" | "lg";
  variant?: "default" | "filled";
}
```

**Features:**
- Size variants matching Input (sm/md/lg) with same padding/font sizes
- Dropdown opens below, scrollable if >6 items visible
- Search input appears when searchable or options > 5
- Keyboard navigation: Arrow Up/Down to navigate, Enter to select, Escape to close
- Focus trap: Tab cycles within open dropdown
- Click outside closes
- Smooth 180ms ease-out open/close animation (match Input transition)

**Styling:**
- Use CSS variables from globals.css (--color-ink, --color-surface, --color-border, --color-accent)
- DM Sans font (--font-body)
- Border radius: 0 (match Input)
- Custom chevron icon (SVG inline, not background-image)
- Highlighted option: subtle background (--color-surface-dim)
- Selected option: checkmark indicator

**Accessibility:**
- role="combobox" on trigger
- role="listbox" on dropdown
- role="option" on items
- aria-expanded, aria-activedescendant
- aria-selected on current option

**Implementation notes:**
- Use useState for open/closed, highlighted index, search term
- Use useRef for container (click outside detection)
- Use useEffect for keyboard event listeners
- Portal NOT needed - position: absolute relative to container
- forwardRef to expose trigger element
  </action>
  <verify>bun run build succeeds with no type errors</verify>
  <done>Select component exports from ui/Select.tsx with all features working</done>
</task>

<task type="auto">
  <name>Task 2: Replace native selects in app components</name>
  <files>app/src/components/ShareDialog.tsx, app/src/components/FormRenderer.tsx, app/src/components/FieldEditor.tsx, app/src/components/FormBuilder.tsx</files>
  <action>
Replace each native `<select>` with the new Select component:

**ShareDialog.tsx (line ~219):**
- Permission dropdown (viewer/editor)
- Options: permissionOptions array already exists
- Transform to SelectOption format if needed
- Size: "sm" to fit inline with other controls

**FormRenderer.tsx (line ~271):**
- Dynamic form field select
- Options come from field.options
- Must handle disabled state (isSubmitting)
- Must handle error state
- Size: "md" to match other form fields

**FieldEditor.tsx (line ~310):**
- Field type dropdown
- Options: FIELD_TYPES array (11 options) - searchable makes sense
- Size: "md"

**FormBuilder.tsx (line ~328):**
- Category dropdown
- Options: hardcoded category list (5 options)
- Size: "md"

**For each replacement:**
1. Import Select from "@/components/ui/Select"
2. Convert options to {value, label} format if not already
3. Replace `<select>` element with `<Select>`
4. Pass value, onChange, options props
5. Remove inline styles (component handles styling)
6. Preserve any label/error handling (component supports these)
  </action>
  <verify>bun run build succeeds, manually test each form opens dropdown correctly</verify>
  <done>All 4 native selects replaced with Select component, no visual regressions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Custom Select component with search, keyboard nav, and smooth animations. Replaced all 5 native selects in the app.</what-built>
  <how-to-verify>
    1. Run: cd app && bun run dev
    2. Visit: http://localhost:3000/style-guide
    3. Test Select in form elements section:
       - Click to open/close
       - Keyboard: Arrow keys navigate, Enter selects, Escape closes
       - Search field appears when appropriate
    4. Visit: http://localhost:3000/forms/new
    5. Test Category dropdown in form builder
    6. Visit: http://localhost:3000/forms/[any-form-id]
    7. Test any select field in a form
    8. Visit: Documents > any doc > Share
    9. Test permission dropdown
    10. Confirm: Smooth animations, brand-consistent styling, no native select appearance
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Update style guide with Select showcase</name>
  <files>app/src/app/style-guide/page.tsx</files>
  <action>
Enhance the style guide's Form Elements section to showcase the Select component properly:

1. Replace the existing native select demo (line ~515) with Select component
2. Add multiple Select examples demonstrating:
   - Default state with placeholder
   - Selected state
   - Different sizes (sm, md, lg) side by side
   - Searchable variant (with more options to trigger search)
   - Disabled state
   - Error state
   - With label and hint text

3. Add a dedicated "Dropdowns" subsection if form elements section is crowded

4. Ensure the showcase demonstrates the premium feel - this is the reference for how dropdowns should look and behave across the app
  </action>
  <verify>bun run build succeeds, style guide page loads with Select showcase</verify>
  <done>Style guide demonstrates all Select variants and states</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd app && bun run build` succeeds without errors
- [ ] Select component renders correctly in all 5 locations
- [ ] Keyboard navigation works (arrows, enter, escape)
- [ ] Search filter works when enabled
- [ ] Animations are smooth (180ms ease-out)
- [ ] All variants display correctly (sizes, states)
- [ ] Human verification approved
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No native `<select>` elements remain in app (except style guide demo comparison if desired)
- Select component feels premium and intentional per 15-CONTEXT.md vision
- Keyboard and mouse interactions both work flawlessly
</success_criteria>

<output>
After completion, create `.planning/phases/15-custom-dropdowns/15-01-SUMMARY.md`
</output>
