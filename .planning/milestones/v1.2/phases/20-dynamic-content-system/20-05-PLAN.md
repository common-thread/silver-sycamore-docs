---
phase: 20-dynamic-content-system
plan: 05
type: execute
wave: 3
depends_on: ["20-02", "20-03", "20-04"]
files_modified: [app/src/components/ContentTypeRenderer.tsx, app/src/app/[category]/[slug]/page.tsx, app/src/app/workspace/page.tsx, app/src/app/activity/page.tsx]
autonomous: false
---

<objective>
Integrate all dynamic content components into the application — create routing component, wire up document pages to use type-specific renderers, add activity sidebar to workspace, create activity dashboard page.

Purpose: Make all the dynamic content features accessible to users through the existing navigation and document viewing flows.
Output: Fully integrated dynamic content system with visual verification.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-dynamic-content-system/20-02-SUMMARY.md
@.planning/phases/20-dynamic-content-system/20-03-SUMMARY.md
@.planning/phases/20-dynamic-content-system/20-04-SUMMARY.md

@app/src/app/[category]/[slug]/page.tsx
@app/src/app/workspace/page.tsx
@app/src/components/DocumentViewer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContentTypeRenderer routing component</name>
  <files>app/src/components/ContentTypeRenderer.tsx</files>
  <action>
Create `ContentTypeRenderer.tsx` — routes documents to type-specific renderers based on contentType.

**Props:**
```typescript
interface ContentTypeRendererProps {
  document: {
    _id: string;
    title: string;
    content: string;
    contentType?: "procedure" | "reference" | "form" | "checklist" | "guide";
    sourceType?: string;
    description?: string;
  };
  fileUrl?: string;
}
```

**Routing logic:**
```typescript
switch (document.contentType) {
  case "procedure":
    return <ProcedureSteps document={document} />;
  case "checklist":
    return <ChecklistView document={document} />;
  case "form":
    // Link to form builder form if formId exists, else show as reference
    return document.formId ? <FormLink formId={document.formId} /> : <DocumentViewer document={document} fileUrl={fileUrl} />;
  case "reference":
  case "guide":
  default:
    return <DocumentViewer document={document} fileUrl={fileUrl} />;
}
```

**Note:** FormLink is a simple component that links to the existing forms system at `/forms/{formId}`.

This component replaces direct DocumentViewer usage in document pages.
  </action>
  <verify>bun run build (component compiles)</verify>
  <done>ContentTypeRenderer correctly routes to appropriate renderer based on contentType</done>
</task>

<task type="auto">
  <name>Task 2: Wire up document page and workspace</name>
  <files>app/src/app/[category]/[slug]/page.tsx, app/src/app/workspace/page.tsx</files>
  <action>
**Update document page (`app/src/app/[category]/[slug]/page.tsx`):**
1. Import ContentTypeRenderer
2. Replace `<DocumentViewer document={document} fileUrl={fileUrl} />` with `<ContentTypeRenderer document={document} fileUrl={fileUrl} />`
3. Add "Share" button that opens ShareLinkDialog (only for procedure/checklist/form types)

**Update workspace page (`app/src/app/workspace/page.tsx`):**
1. Import ActivitySidebar
2. Add ActivitySidebar component to the sidebar area
3. Position below existing folder tree / document list

The workspace layout should look like:
```
+---------------------+---------------------------+
|  [Folders/Docs]     |  [Document Content]       |
|                     |                           |
|  - Folder 1         |                           |
|  - Folder 2         |                           |
|  - My Document      |                           |
|                     |                           |
|  ─────────────────  |                           |
|  [My Activity]      |                           |
|  ✓ Completed...     |                           |
|  □ Started...       |                           |
|  [View All →]       |                           |
+---------------------+---------------------------+
```
  </action>
  <verify>bun run build (pages compile)</verify>
  <done>Document pages use ContentTypeRenderer, workspace shows ActivitySidebar</done>
</task>

<task type="auto">
  <name>Task 3: Create activity dashboard page</name>
  <files>app/src/app/activity/page.tsx</files>
  <action>
Create activity dashboard page at `/activity`.

**Route:** `app/src/app/activity/page.tsx`

**Content:**
1. Import ActivityDashboard component
2. Wrap in standard page layout (PageHeader + ContentBox)
3. Title: "Activity History"
4. Description: "Track your completed procedures, checklists, and form submissions"

**Page structure:**
```tsx
export default function ActivityPage() {
  return (
    <>
      <PageHeader
        title="Activity History"
        description="Track your completed procedures, checklists, and form submissions"
      />
      <ContentBox>
        <ActivityDashboard />
      </ContentBox>
    </>
  );
}
```

**Add to Header navigation:**
- Add "Activity" link to Header.tsx navigation (after Forms, before any admin-only items)
  </action>
  <verify>bun run build (page compiles, route accessible)</verify>
  <done>Activity page accessible at /activity with proper navigation</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete dynamic content system integration:
- Procedures display with interactive step tracking
- Checklists display with checkbox completion
- Activity sidebar in workspace
- Activity dashboard at /activity
- Share functionality on dynamic documents</what-built>
  <how-to-verify>
    1. Run: `bun run dev` (in app directory) and `npx convex dev` (separate terminal)
    2. Visit: http://localhost:3000/procedures
    3. Click on any procedure document
    4. Verify: You see numbered steps with checkboxes, progress bar at top
    5. Check a step — verify checkbox persists after page refresh
    6. Visit: http://localhost:3000/checklists
    7. Click on any checklist document
    8. Verify: You see checklist items with checkboxes
    9. Visit: http://localhost:3000/workspace
    10. Verify: "My Activity" section appears in sidebar
    11. Visit: http://localhost:3000/activity
    12. Verify: Activity dashboard shows your recent completions with filters
    13. On a procedure page, click "Share" button
    14. Verify: Share dialog opens with internal/external options
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bun run build` succeeds without errors
- [ ] Procedures render with ProcedureSteps component
- [ ] Checklists render with ChecklistView component
- [ ] Activity sidebar visible in workspace
- [ ] Activity dashboard accessible at /activity
- [ ] Visual verification passed
</verification>

<success_criteria>

- All tasks completed
- User approved visual verification
- Dynamic content system fully integrated
- Share functionality accessible on dynamic documents
</success_criteria>

<output>
After completion, create `.planning/phases/20-dynamic-content-system/20-05-SUMMARY.md`
</output>
