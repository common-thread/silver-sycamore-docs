---
phase: 21-form-builder-visual-rebuild
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/package.json
  - app/src/components/DraggableFieldCard.tsx
  - app/src/components/FormBuilder.tsx
autonomous: true
---

<objective>
Create the foundation for Google Forms-style visual form builder with drag-and-drop field cards and inline editing.

Purpose: Replace the current modal-based field editing with inline editing on draggable cards, enabling faster form creation with visual clarity.
Output: DraggableFieldCard component with inline editing, dnd-kit integration ready for FormBuilder.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-form-builder-visual-rebuild/21-CONTEXT.md

# Current implementation to replace:
@app/src/components/FormBuilder.tsx
@app/src/components/FieldEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit and create field type definitions</name>
  <files>app/package.json, app/src/components/DraggableFieldCard.tsx</files>
  <action>
1. Install dnd-kit packages:
   ```bash
   cd app && bun add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
   ```

2. Create `DraggableFieldCard.tsx` with shared type definitions extracted from FormBuilder:
   - Export `FormFieldType` union type (text, textarea, number, date, time, email, tel, select, multiselect, checkbox, file)
   - Export `FormField` interface (name, type, label, required, options?, placeholder?)
   - Export `FIELD_TYPES` constant array for dropdown options
   - Create placeholder component structure (will be implemented in Task 2)

Use design tokens exclusively (no hardcoded colors, spacing, or typography values). Follow existing component patterns from Input.tsx and Select.tsx.
  </action>
  <verify>
1. Run `cd app && bun install` - should complete without errors
2. Run `cd app && bunx tsc --noEmit` - should pass type checking
3. Check `@dnd-kit/core` is in package.json dependencies
  </verify>
  <done>
- dnd-kit packages installed
- Type definitions exported from DraggableFieldCard.tsx
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Build DraggableFieldCard with inline editing</name>
  <files>app/src/components/DraggableFieldCard.tsx</files>
  <wireframe>
+--------------------------------------------------+
| [≡] Field Label                    [Type] [Req] X |
|     Click to edit...                              |
+--------------------------------------------------+

Expanded (editing mode):
+--------------------------------------------------+
| [≡] [Label input_______________]                  |
|     Type: [Dropdown_____v]                        |
|     Placeholder: [________________]               |
|     [ ] Required                                  |
|     [Options section if select/multiselect]       |
|     [Done]                                        |
+--------------------------------------------------+
  </wireframe>
  <action>
Implement `DraggableFieldCard` component with:

1. **Collapsed State (default):**
   - Drag handle (≡) on the left using `useSortable` from @dnd-kit/sortable
   - Field label displayed prominently
   - Field type badge (small, uppercase)
   - Required indicator if applicable
   - Delete button (X) on the right
   - Click anywhere on card to expand for editing

2. **Expanded State (inline editing):**
   - Label input field (auto-focus on expand)
   - Type dropdown using Select component
   - Placeholder input (optional)
   - Required checkbox
   - Options editor for select/multiselect types (same pattern as current FieldEditor)
   - Done button to collapse and save

3. **Props interface:**
   ```typescript
   interface DraggableFieldCardProps {
     field: FormField;
     index: number;
     isEditing: boolean;
     onStartEdit: () => void;
     onSave: (field: FormField) => void;
     onDelete: () => void;
     existingFieldNames: string[];
   }
   ```

4. **Styling requirements:**
   - Use design tokens exclusively (var(--space-*), var(--color-*), var(--text-*))
   - Card background: var(--color-surface)
   - Border: 1px solid var(--color-border)
   - Drag handle cursor: grab/grabbing
   - Smooth transition on expand/collapse: var(--duration-fast) var(--ease-default)
   - No border-radius (brand aesthetic)

5. **Validation:**
   - Label required (show inline error if empty on save)
   - Auto-generate field name from label using slugify
   - Options required for select/multiselect types
  </action>
  <verify>
1. Run `cd app && bunx tsc --noEmit` - should pass
2. Run `cd app && bun run build` - should succeed
3. Verify component exports correctly: `import { DraggableFieldCard } from '@/components/DraggableFieldCard'`
  </verify>
  <done>
- DraggableFieldCard component fully implemented
- Collapsed and expanded states working
- Inline editing with validation
- Design tokens used exclusively
- Build passes without errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd app && bun install` completes successfully
- [ ] `cd app && bunx tsc --noEmit` passes
- [ ] `cd app && bun run build` succeeds
- [ ] DraggableFieldCard exports FormField, FormFieldType, FIELD_TYPES
- [ ] Component uses design tokens exclusively (grep for hardcoded values)
</verification>

<success_criteria>
- dnd-kit packages installed and available
- DraggableFieldCard component created with inline editing
- All type definitions exported for use by FormBuilder
- No TypeScript errors, build passes
- Design tokens used throughout (no hardcoded styles)
</success_criteria>

<output>
After completion, create `.planning/phases/21-form-builder-visual-rebuild/21-01-SUMMARY.md`
</output>
