---
phase: 21-form-builder-visual-rebuild
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - app/src/components/FormBuilder.tsx
  - app/src/components/FieldEditor.tsx
autonomous: false
---

<objective>
Integrate DraggableFieldCard into FormBuilder, replacing the modal-based FieldEditor with inline editing and drag-and-drop reordering.

Purpose: Complete the Google Forms-like form builder experience with visual clarity and direct manipulation.
Output: Fully functional form builder with drag-and-drop field cards and inline editing, verified via browser screenshots.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-form-builder-visual-rebuild/21-CONTEXT.md
@.planning/phases/21-form-builder-visual-rebuild/21-01-SUMMARY.md

# Components being integrated:
@app/src/components/FormBuilder.tsx
@app/src/components/DraggableFieldCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor FormBuilder with dnd-kit and DraggableFieldCard</name>
  <files>app/src/components/FormBuilder.tsx</files>
  <wireframe>
+--------------------------------------------------+
|  Form Details                                     |
+--------------------------------------------------+
|  Title: [_______________________________]         |
|  Description: [_____________________________]     |
|  Category: [Dropdown_______________v]             |
+--------------------------------------------------+

+--------------------------------------------------+
|  Fields                              [+ Add Field]|
+--------------------------------------------------+
|  +--------------------------------------------+  |
|  | [≡] Full Name              [text] [req] X |  |
|  +--------------------------------------------+  |
|  +--------------------------------------------+  |
|  | [≡] Email Address          [email] [req] X |  |  <- Expanded, editing
|  |     Label: [Email Address_______]          |  |
|  |     Type: [Email_________v]                |  |
|  |     [x] Required                           |  |
|  |     [Done]                                 |  |
|  +--------------------------------------------+  |
|  +--------------------------------------------+  |
|  | [≡] Phone Number           [tel]        X |  |
|  +--------------------------------------------+  |
+--------------------------------------------------+

|                    [Cancel] [Save Draft] [Save]  |
+--------------------------------------------------+
  </wireframe>
  <action>
Refactor FormBuilder.tsx to use dnd-kit and DraggableFieldCard:

1. **Import dnd-kit:**
   ```typescript
   import { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors, DragEndEvent } from '@dnd-kit/core';
   import { arrayMove, SortableContext, sortableKeyboardCoordinates, verticalListSortingStrategy } from '@dnd-kit/sortable';
   import { DraggableFieldCard, FormField, FormFieldType, FIELD_TYPES } from './DraggableFieldCard';
   ```

2. **Replace field list rendering:**
   - Wrap field list in `<DndContext>` and `<SortableContext>`
   - Replace current field row rendering with `<DraggableFieldCard>` components
   - Remove the FieldEditor modal rendering entirely

3. **State management updates:**
   - Track `editingFieldIndex: number | null` (which field is expanded)
   - Remove `isAddingField` boolean (new fields are added collapsed, user expands to edit)
   - Handle drag end with `arrayMove` to reorder fields

4. **Add Field button behavior:**
   - Create new field with default values: `{ name: '', type: 'text', label: '', required: false }`
   - Append to fields array
   - Set `editingFieldIndex` to new field's index (auto-expand for editing)

5. **Event handlers:**
   - `handleDragEnd`: Reorder fields using arrayMove
   - `handleFieldSave`: Update field at editingFieldIndex, validate, collapse
   - `handleFieldDelete`: Remove field, adjust editingFieldIndex if needed
   - `handleStartEdit`: Set editingFieldIndex (only one field editable at a time)

6. **Remove FieldEditor import and usage** - no longer needed

7. **Ensure design token usage:**
   - Keep existing Form Details section styling (already using tokens from Phase 17)
   - Fields section uses DraggableFieldCard (which uses tokens)
  </action>
  <verify>
1. Run `cd app && bunx tsc --noEmit` - should pass
2. Run `cd app && bun run build` - should succeed
3. Verify no FieldEditor import in FormBuilder.tsx
  </verify>
  <done>
- FormBuilder uses dnd-kit for drag-and-drop
- Fields rendered as DraggableFieldCard components
- Inline editing replaces modal
- FieldEditor modal removed from FormBuilder
- Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Browser verification and screenshots</name>
  <files>.planning/phases/21-form-builder-visual-rebuild/screenshots/</files>
  <action>
1. **Start the dev server:**
   ```bash
   cd /Users/splurfa/projects/clients/silver-sycamore-deliverables/silver-sycamore-docs/app
   pkill -f "next dev" 2>/dev/null || true
   pkill -f "convex dev" 2>/dev/null || true
   npx convex dev &
   bun run dev &
   sleep 5
   ```

2. **Use browser automation to test and capture screenshots:**

   a. Navigate to http://localhost:3000/forms/new
   b. Screenshot: Empty form builder state → `02-01-empty-builder.png`

   c. Fill in form details (Title: "Test Form", Description: "Testing drag-drop")
   d. Click "Add Field" button
   e. Screenshot: New field card expanded for editing → `02-02-add-field-expanded.png`

   f. Fill field (Label: "Full Name", Type: text, Required: checked)
   g. Click Done
   h. Screenshot: Field collapsed after save → `02-03-field-collapsed.png`

   i. Add second field (Label: "Email", Type: email)
   j. Add third field (Label: "Phone", Type: tel)
   k. Screenshot: Multiple fields → `02-04-multiple-fields.png`

   l. Drag middle field to top position
   m. Screenshot: After drag reorder → `02-05-drag-reorder.png`

   n. Click on a field to expand inline editor
   o. Screenshot: Inline editing mode → `02-06-inline-editing.png`

3. **Save all screenshots to:**
   `.planning/phases/21-form-builder-visual-rebuild/screenshots/`

4. **Verify UX matches vision:**
   - Cards are visually distinct and draggable
   - Inline editing is smooth (no modal blocking view)
   - Drag handles are visible and functional
   - Typography uses design system fonts
  </action>
  <verify>
1. All 6 screenshots saved to screenshots folder
2. Screenshots show expected UI states
3. No console errors in browser
  </verify>
  <done>
- 6 verification screenshots captured
- Form builder functional with drag-drop
- Inline editing working
- Screenshots saved for user review
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Google Forms-style form builder with drag-and-drop field cards and inline editing</what-built>
  <how-to-verify>
Review screenshots in `.planning/phases/21-form-builder-visual-rebuild/screenshots/`:

| Screenshot | Expected |
|------------|----------|
| 02-01-empty-builder.png | Clean empty state with Add Field button |
| 02-02-add-field-expanded.png | New field card expanded with inline editor |
| 02-03-field-collapsed.png | Collapsed field card showing label, type, required |
| 02-04-multiple-fields.png | 3 field cards in a list |
| 02-05-drag-reorder.png | Fields reordered via drag |
| 02-06-inline-editing.png | Field expanded for inline editing |

**Verify:**
1. No modals blocking the view
2. Drag handles visible on each card
3. Inline editing looks clean and fast
4. Design system fonts and colors used
5. Cards have clear visual boundaries
  </how-to-verify>
  <resume-signal>Type "approved" if screenshots look good, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FormBuilder uses dnd-kit for drag-and-drop
- [ ] DraggableFieldCard renders each field
- [ ] Inline editing works (no modals)
- [ ] Drag reordering functional
- [ ] 6 screenshots captured in screenshots folder
- [ ] User approved screenshots
</verification>

<success_criteria>
- FormBuilder refactored to use DraggableFieldCard
- Drag-and-drop reordering works
- Inline editing replaces modal
- All verification screenshots captured
- User approved the visual implementation
</success_criteria>

<output>
After completion, create `.planning/phases/21-form-builder-visual-rebuild/21-02-SUMMARY.md`

Include in summary:
- Link to screenshots folder: `.planning/phases/21-form-builder-visual-rebuild/screenshots/`
- Table of screenshots with descriptions
</output>
