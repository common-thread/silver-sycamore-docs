---
phase: 02-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [app/convex/auth.config.ts, app/convex/auth.ts, app/convex/schema.ts, app/convex/http.ts]
autonomous: true
---

<objective>
Set up Convex Auth backend configuration for password authentication.

Purpose: Enable user authentication in the Convex backend with password provider.
Output: Auth tables in schema, auth configuration files, HTTP routes for auth.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/02-authentication/RESEARCH.md
@app/convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Convex Auth dependencies</name>
  <files>app/package.json</files>
  <action>
Run in app/ directory:
```bash
bun add @convex-dev/auth @auth/core@0.37.0
```

Verify installation in package.json.
  </action>
  <verify>Dependencies appear in package.json</verify>
  <done>@convex-dev/auth and @auth/core installed</done>
</task>

<task type="auto">
  <name>Task 2: Create auth.config.ts</name>
  <files>app/convex/auth.config.ts</files>
  <action>
Create `convex/auth.config.ts`:

```typescript
export default {
  providers: [
    {
      domain: process.env.CONVEX_SITE_URL,
      applicationID: "convex",
    },
  ],
};
```

This configures Convex as the authentication issuer.
  </action>
  <verify>File exists with correct content</verify>
  <done>auth.config.ts created</done>
</task>

<task type="auto">
  <name>Task 3: Create auth.ts with Password provider</name>
  <files>app/convex/auth.ts</files>
  <action>
Create `convex/auth.ts`:

```typescript
import { Password } from "@convex-dev/auth/providers/Password";
import { convexAuth } from "@convex-dev/auth/server";

export const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({
  providers: [Password],
});
```

This exports auth functions for use in other Convex functions.
  </action>
  <verify>File exists with Password provider configured</verify>
  <done>auth.ts created with Password provider</done>
</task>

<task type="auto">
  <name>Task 4: Update schema.ts with auth tables</name>
  <files>app/convex/schema.ts</files>
  <action>
Update `convex/schema.ts` to include auth tables:

1. Add import: `import { authTables } from "@convex-dev/auth/server";`
2. Spread `...authTables` at the start of defineSchema

The auth tables include: users, authAccounts, authSessions, authRefreshTokens, authVerificationCodes, authVerifiers, authRateLimits
  </action>
  <verify>Schema includes authTables spread</verify>
  <done>schema.ts updated with auth tables</done>
</task>

<task type="auto">
  <name>Task 5: Create http.ts for auth routes</name>
  <files>app/convex/http.ts</files>
  <action>
Create `convex/http.ts` to expose auth HTTP endpoints:

```typescript
import { httpRouter } from "convex/server";
import { auth } from "./auth";

const http = httpRouter();

auth.addHttpRoutes(http);

export default http;
```

This creates the necessary HTTP routes for auth flows.
  </action>
  <verify>http.ts exists and exports router with auth routes</verify>
  <done>http.ts created with auth routes</done>
</task>

<task type="auto">
  <name>Task 6: Generate AUTH_SECRET</name>
  <files>app/.env.local</files>
  <action>
Generate a secure secret and add to .env.local:

```bash
openssl rand -base64 32
```

Add to .env.local:
```
AUTH_SECRET=<generated-secret>
```

Note: Do NOT commit .env.local to git.
  </action>
  <verify>.env.local contains AUTH_SECRET</verify>
  <done>AUTH_SECRET configured</done>
</task>

<task type="auto">
  <name>Task 7: Run Convex dev to sync schema</name>
  <files>app/convex/_generated/*</files>
  <action>
Ensure Convex dev server syncs the new schema:

```bash
cd app && npx convex dev --once
```

This will:
1. Push schema changes to Convex
2. Regenerate _generated types
3. Create auth tables in database
  </action>
  <verify>Convex dev completes without errors, _generated files updated</verify>
  <done>Schema synced, auth tables created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] @convex-dev/auth in package.json
- [ ] convex/auth.config.ts exists
- [ ] convex/auth.ts exists with Password provider
- [ ] convex/schema.ts includes authTables
- [ ] convex/http.ts exports auth routes
- [ ] AUTH_SECRET in .env.local
- [ ] Convex dev syncs without errors
</verification>

<success_criteria>
- All auth backend files created
- Schema includes auth tables
- Convex syncs successfully
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-01-SUMMARY.md`
Record: files created, any issues encountered, next steps
</output>
