---
phase: 04-wiki-search-navigation
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified: [app/src/components/Breadcrumb.tsx, app/src/components/RelatedDocs.tsx, app/src/app/[category]/[slug]/page.tsx]
autonomous: false
---

<objective>
Enhance breadcrumbs with document context and add related documents section.

Purpose: Improve navigation context and document discovery.
Output: Enhanced breadcrumbs, related documents component.
</objective>

<context>
@.planning/PROJECT.md
@app/src/components/Breadcrumb.tsx
@app/src/app/[category]/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add related documents query</name>
  <files>app/convex/documents.ts</files>
  <action>
Add to `convex/documents.ts`:

```typescript
// Get related documents (same category, excluding current)
export const related = query({
  args: {
    documentId: v.id("documents"),
    category: v.string(),
    limit: v.optional(v.number())
  },
  handler: async (ctx, args) => {
    const docs = await ctx.db
      .query("documents")
      .withIndex("by_category", (q) => q.eq("category", args.category))
      .collect();

    // Filter out current document and limit
    return docs
      .filter(d => d._id !== args.documentId)
      .slice(0, args.limit ?? 5);
  },
});
```
  </action>
  <verify>Related query returns sibling documents</verify>
  <done>Related documents query added</done>
</task>

<task type="auto">
  <name>Task 2: Create RelatedDocs component</name>
  <files>app/src/components/RelatedDocs.tsx</files>
  <action>
Create `src/components/RelatedDocs.tsx`:

- Takes documentId and category as props
- Uses `useQuery(api.documents.related, { documentId, category })`
- Shows "Related Documents" heading
- Lists up to 5 related documents as links
- Compact card style matching design system
- Hide if no related documents
  </action>
  <verify>RelatedDocs shows sibling documents</verify>
  <done>RelatedDocs component created</done>
</task>

<task type="auto">
  <name>Task 3: Enhance Breadcrumb with document title</name>
  <files>app/src/components/Breadcrumb.tsx</files>
  <action>
Update Breadcrumb to:

1. Accept optional `documentTitle` prop
2. When on document page, show: Home / Category / Document Title
3. Use category name from Convex if available
4. Style last item differently (current page)
5. Add chevron separators instead of slashes for editorial feel
  </action>
  <verify>Breadcrumb shows document context</verify>
  <done>Enhanced breadcrumb with document title</done>
</task>

<task type="auto">
  <name>Task 4: Add RelatedDocs to document page</name>
  <files>app/src/app/[category]/[slug]/page.tsx</files>
  <action>
Update document page to:

1. Pass document title to Breadcrumb
2. Add RelatedDocs below document content
3. Style as sidebar or bottom section
  </action>
  <verify>Document page shows related docs</verify>
  <done>Document page enhanced</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Search, navigation, and document discovery features</what-built>
  <how-to-verify>
    1. Run: cd app && bun run dev
    2. Test search bar - type "wedding" and see results
    3. Click a result to navigate to document
    4. Check breadcrumb shows document title
    5. Check related documents appear
    6. Navigate categories via CategoryGrid
  </how-to-verify>
  <resume-signal>Type "approved" if Phase 04 is complete, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Related documents query works
- [ ] RelatedDocs component renders
- [ ] Breadcrumb shows document title
- [ ] Document page has related docs section
- [ ] Human verified
</verification>

<success_criteria>
- Documents are easy to discover via search and related links
- Navigation context is always clear via breadcrumbs
- Staff can browse related content easily
</success_criteria>

<output>
After completion, create `.planning/phases/04-wiki-search-navigation/04-03-SUMMARY.md`

Record:
- Search implementation details
- Navigation patterns established
- Phase 04 completion status
</output>
