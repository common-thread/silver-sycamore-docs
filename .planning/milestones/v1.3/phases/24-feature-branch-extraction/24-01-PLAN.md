---
phase: 24-feature-branch-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [app/.env.local, app/src/components/ConvexClientProvider.tsx, .planning/phases/24-feature-branch-extraction/EXTRACTION.md]
autonomous: true
---

<objective>
Create feature preservation branch and implement auth toggle for simplified development.

Purpose: Establish clean baseline for wiki-focused work while preserving all feature code on a branch. Enable auth bypass for single-user development mode.
Output: Feature branch with full codebase, auth toggle system, extraction inventory document.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-feature-branch-extraction/24-CONTEXT.md

@app/src/components/ConvexClientProvider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create feature preservation branch</name>
  <files>git operations only</files>
  <action>
Create a new branch `feature/full-v1` from current main state. This branch preserves the complete feature set (messaging, forms builder, comments, procedures, checklists) as a return path.

Steps:
1. Ensure working directory is clean (commit any pending changes first)
2. Create branch: `git checkout -b feature/full-v1`
3. Push branch: `git push -u origin feature/full-v1`
4. Return to main: `git checkout main`

This branch is NOT archived - it's a living feature branch that can be merged back when wiki content work is complete.
  </action>
  <verify>Run `git branch -a` to confirm feature/full-v1 exists locally and remotely</verify>
  <done>Branch `feature/full-v1` exists and is pushed to origin, main is checked out</done>
</task>

<task type="auto">
  <name>Task 2: Implement auth environment toggle</name>
  <files>app/.env.local, app/.env.example, app/src/components/ConvexClientProvider.tsx</files>
  <action>
Add environment variable toggle to bypass authentication for single-user development mode.

1. Add to `.env.local` (create if missing) and `.env.example`:
```
# Auth toggle - set to "false" to bypass authentication (single-user mode)
NEXT_PUBLIC_ENABLE_AUTH=true
```

2. Modify ConvexClientProvider.tsx to respect the toggle:
- Check `process.env.NEXT_PUBLIC_ENABLE_AUTH !== 'false'`
- When auth disabled: skip ClerkProvider wrapping, render children directly
- When auth enabled: use existing ClerkProvider + ConvexProviderWithClerk setup

3. The toggle should:
- Default to auth ENABLED if env var is missing or "true"
- Only bypass auth when explicitly set to "false"
- Not require any other code changes (auth checks in components gracefully handle unauthenticated state)

Note: Keep all auth-related code intact - this is a runtime toggle, not code removal.
  </action>
  <verify>
1. Set NEXT_PUBLIC_ENABLE_AUTH=false, run `bun run dev`, confirm app loads without login screen
2. Set NEXT_PUBLIC_ENABLE_AUTH=true (or remove), confirm login is required
  </verify>
  <done>Auth toggle works in both modes, env.example documents the variable</done>
</task>

<task type="auto">
  <name>Task 3: Create extraction inventory document</name>
  <files>.planning/phases/24-feature-branch-extraction/EXTRACTION.md</files>
  <action>
Create EXTRACTION.md documenting exactly what will be removed from main and how to restore it.

Document should include:

## Features Being Extracted
- Messaging system (channels, DMs, notifications)
- Forms builder (form creation and management)
- Comments system (threaded comments on documents)
- Interactive content features (procedure stepping, checklist completion)
- Activity dashboard and sidebar

## Files to Remove (by feature)

### Messaging
Routes:
- app/src/app/messages/** (entire directory)

Components:
- app/src/components/ChannelList.tsx
- app/src/components/MessageList.tsx
- app/src/components/MessageItem.tsx
- app/src/components/MessageInput.tsx
- app/src/components/CreateChannelDialog.tsx
- app/src/components/StartDMDialog.tsx
- app/src/components/NotificationBell.tsx
- app/src/components/NotificationInbox.tsx

### Forms Builder
Routes:
- app/src/app/forms/** (entire directory)

Components:
- app/src/components/FormBuilder.tsx
- app/src/components/FieldEditor.tsx
- app/src/components/DraggableFieldCard.tsx
- app/src/components/FormShareDialog.tsx
- app/src/components/SubmissionViewer.tsx

### Comments
Components:
- app/src/components/CommentSection.tsx
- app/src/components/CommentItem.tsx
- app/src/components/MentionInput.tsx

### Interactive Content / Activity
Routes:
- app/src/app/activity/page.tsx
- app/src/app/procedures/page.tsx (optional - just filtered list)
- app/src/app/checklists/page.tsx (optional - just filtered list)

Components:
- app/src/components/ProcedureSteps.tsx
- app/src/components/ChecklistView.tsx
- app/src/components/ActivityDashboard.tsx
- app/src/components/ActivitySidebar.tsx

## What Stays
- All Convex schema tables (non-breaking, can be unused)
- All Convex functions (can be unused, no build errors)
- Wiki document system
- Personal workspace
- Document versioning
- Search functionality
- User profiles and auth system (toggleable)

## Restoration Path
To restore features:
1. Merge `feature/full-v1` branch back to main
2. Set NEXT_PUBLIC_ENABLE_AUTH=true
3. Run build to verify

## Connectors
Mark in code where features connect using comments:
```typescript
// CONNECTOR: messaging - restore from feature/full-v1
// CONNECTOR: forms-builder - restore from feature/full-v1
```
  </action>
  <verify>File exists and contains complete inventory with all files listed</verify>
  <done>EXTRACTION.md exists with full inventory and restoration instructions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `feature/full-v1` branch exists locally and remotely
- [ ] Auth toggle works (test both modes)
- [ ] EXTRACTION.md contains complete file inventory
- [ ] Main branch is checked out and ready for extraction work
</verification>

<success_criteria>
- Feature branch created and pushed as preservation/return path
- Auth can be bypassed via environment variable
- Complete extraction inventory documented
- No code changes that would break the build yet
</success_criteria>

<output>
After completion, create `.planning/phases/24-feature-branch-extraction/24-01-SUMMARY.md`
</output>
