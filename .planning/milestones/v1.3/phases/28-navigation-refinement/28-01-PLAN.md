---
phase: 28-navigation-refinement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/convex/documents.ts
  - app/src/components/ContextCatalog.tsx
autonomous: true
---

<objective>
Create backend query and shared UI component for context-based document browsing.

Purpose: Foundation for the new navigation system that organizes content by work context (Events, Services, Operations) with content type as a secondary filter.

Output: Convex query for multi-category filtering, reusable ContextCatalog component with type filter chips.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-navigation-refinement/28-CONTEXT.md

# Existing patterns to follow:
@app/convex/documents.ts
@app/src/app/procedures/page.tsx
@app/src/components/ContentBox.tsx
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create byCategories Convex query</name>
  <files>app/convex/documents.ts</files>
  <action>
Add a new query `byCategories` that accepts:
- `categories`: array of category strings (e.g., ["clients"], ["staff", "operations"])
- `contentType`: optional content type filter

Query should:
1. Fetch all documents
2. Filter by categories (document.category in categories array)
3. Optionally filter by contentType if provided
4. Return filtered results

Follow existing query patterns in the file. Use `v.array(v.string())` for categories param.
Do NOT add a new index - client-side filtering is fine for this dataset size (~70 docs).
  </action>
  <verify>TypeScript compiles: `cd app && npx tsc --noEmit`</verify>
  <done>byCategories query exported and accepts categories array + optional contentType</done>
</task>

<task type="auto">
  <name>Task 2: Create ContextCatalog component</name>
  <files>app/src/components/ContextCatalog.tsx</files>
  <action>
Create a reusable component that displays documents filtered by context with type filtering.

Props interface:
```typescript
interface ContextCatalogProps {
  title: string;
  description: string;
  categories: string[];  // Categories to include (e.g., ["clients"])
}
```

Component structure:
1. Use `useQuery(api.documents.byCategories, { categories })` to fetch documents
2. Local state for selected content type filter (null = all, or "procedure" | "reference" | etc.)
3. Type filter chips at top - only show chips for types that exist in the results
4. Document list below (follow procedures/page.tsx list styling)

Type filter chips:
- Horizontal row of clickable chips
- "All" chip + one chip per content type found in results
- Active chip highlighted (use --color-accent background, white text)
- Inactive chips: border style, --color-ink text
- Use inline styles following project conventions

Document list:
- Filter documents by selected contentType (client-side)
- Show title as link to `/${doc.category}/${doc.slug}`
- Show description if present
- Style matches procedures/page.tsx list items

Use PageHeader component for title/description (import from @/components/PageHeader).
Use ContentBox for the content area.
Follow existing component patterns (inline styles, design tokens).
  </action>
  <verify>TypeScript compiles: `cd app && npx tsc --noEmit`</verify>
  <done>ContextCatalog component renders with type filter chips and filtered document list</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd app && npx tsc --noEmit` passes
- [ ] `cd app && bun run build` succeeds
- [ ] byCategories query accepts array of categories
- [ ] ContextCatalog component exports correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Component follows project conventions (inline styles, design tokens)
- Query handles edge cases (empty categories array, no matching contentType)
</success_criteria>

<output>
After completion, create `.planning/phases/28-navigation-refinement/28-01-SUMMARY.md`
</output>
