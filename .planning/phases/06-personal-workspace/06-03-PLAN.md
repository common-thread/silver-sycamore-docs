---
phase: 06-personal-workspace
plan: 03
status: pending
---

# Plan 06-03: Document Duplication

## Objective

Allow users to copy wiki documents to their personal workspace for private annotation, modification, or reference.

## Context

- Wiki documents exist in `documents` table
- Personal documents exist in `personalDocuments` table
- Users browse wiki and may want personal copies
- Need to track source document for reference

## Tasks

### 1. Add Copy Mutation
**File**: `convex/personalDocuments.ts`

Add `copyFromWiki` mutation:
```typescript
copyFromWiki: mutation({
  args: {
    documentId: v.id("documents"),      // Source wiki doc
    folderId: v.optional(v.id("personalFolders")), // Target folder
  },
  handler: async (ctx, args) => {
    // 1. Verify user is authenticated
    // 2. Get source document
    // 3. Create personal copy with sourceDocumentId reference
    // 4. Return new document ID
  },
})
```

### 2. Add "Copy to Workspace" Button
**File**: `src/app/[category]/[slug]/page.tsx`

- Add button in document view header
- Only shows for authenticated users
- Opens folder picker or copies to root
- Shows success toast with link to workspace

### 3. Create Folder Picker Dialog
**File**: `src/components/FolderPicker.tsx`

- Modal dialog for selecting target folder
- Shows folder tree
- "Copy Here" and "Cancel" buttons
- Option to create new folder inline

### 4. Add Source Document Link
**File**: `src/app/workspace/[docId]/page.tsx`

- If document has `sourceDocumentId`, show link
- "Copied from: [Document Title]"
- Links back to original wiki document

### 5. Add Copy Indicator to Doc List
**File**: `src/components/PersonalDocList.tsx`

- Visual indicator if document is a copy
- Small icon or badge showing "from wiki"
- Tooltip with source document name

## Verification

- [ ] Can copy wiki document to personal workspace
- [ ] Copy preserves title and content
- [ ] Source reference is stored and displayed
- [ ] Folder picker works for targeting
- [ ] Multiple copies of same doc allowed
- [ ] TypeScript compiles

## Edge Cases

- Source document deleted: Link shows "Original removed"
- Source document updated: No auto-sync (copies are independent)
- Copy to nested folder: Works with folder picker
