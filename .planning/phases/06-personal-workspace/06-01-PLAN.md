---
phase: 06-personal-workspace
plan: 01
status: pending
---

# Plan 06-01: Personal Folder Schema and Storage

## Objective

Create the data model and Convex backend for personal user documentsâ€”private documents owned by individual users that exist separately from the shared wiki.

## Context

- Users have profiles with roles (from Phase 3)
- Documents table exists for shared wiki content
- Need separate storage for personal documents
- Each user gets their own private workspace

## Tasks

### 1. Define Personal Documents Schema
**File**: `convex/schema.ts`

Add `personalDocuments` table:
```typescript
personalDocuments: defineTable({
  ownerId: v.id("users"),           // Document owner
  title: v.string(),
  content: v.string(),
  folderId: v.optional(v.id("personalFolders")), // Optional folder organization
  sourceDocumentId: v.optional(v.id("documents")), // If copied from wiki
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_owner", ["ownerId"])
  .index("by_owner_folder", ["ownerId", "folderId"]),
```

Add `personalFolders` table for organization:
```typescript
personalFolders: defineTable({
  ownerId: v.id("users"),
  name: v.string(),
  parentId: v.optional(v.id("personalFolders")), // Nested folders
  createdAt: v.number(),
})
  .index("by_owner", ["ownerId"])
  .index("by_owner_parent", ["ownerId", "parentId"]),
```

### 2. Create Personal Documents Queries
**File**: `convex/personalDocuments.ts` (new)

Implement:
- `list` - Get user's personal documents (optionally filtered by folder)
- `get` - Get single personal document by ID
- `getByFolder` - Get documents in a specific folder

All queries must verify the requesting user owns the document.

### 3. Create Personal Documents Mutations
**File**: `convex/personalDocuments.ts`

Implement:
- `create` - Create new personal document
- `update` - Update title/content
- `delete` - Delete personal document
- `moveToFolder` - Move document to different folder

### 4. Create Personal Folders Queries/Mutations
**File**: `convex/personalFolders.ts` (new)

Implement:
- `list` - Get user's folders (optionally filtered by parent)
- `create` - Create new folder
- `rename` - Rename folder
- `delete` - Delete folder (must be empty or cascade)

## Verification

- [ ] Schema deploys without errors
- [ ] Can create personal document via Convex dashboard
- [ ] Can query user's documents
- [ ] Can create nested folders
- [ ] TypeScript compiles

## Dependencies

- Phase 3 complete (user profiles exist)
