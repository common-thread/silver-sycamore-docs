---
phase: 19-redundant-content-ia-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/convex/schema.ts
  - app/scripts/lib/contentTypeMapping.ts
  - app/scripts/import-documents.ts
autonomous: true
---

<objective>
Add contentType field to documents schema and update import script to assign types and exclude redundant forms.

Purpose: Enable purpose-based content organization by classifying documents into procedure, reference, form, checklist, or guide types based on Phase 18 content audit.
Output: Schema with contentType field, import script that assigns types and excludes 18 redundant form documents.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/milestones/v1.2-REFERENCES.md
@.planning/phases/16-code-mapping-style-audit/DESIRED-STATE.md
@.planning/phases/18-content-audit-type-decisions/CONTENT-TRACKER.md
@.planning/phases/18-content-audit-type-decisions/18-FIX-SUMMARY.md
@app/convex/schema.ts
@app/scripts/import-documents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add contentType field to documents schema</name>
  <files>app/convex/schema.ts</files>
  <action>
Add `contentType` optional field to the documents table definition:
- Type: `v.optional(v.union(v.literal("procedure"), v.literal("reference"), v.literal("form"), v.literal("checklist"), v.literal("guide")))`
- Add index `by_contentType` on `["contentType"]` for efficient filtering
- Also add optional `formId` field: `v.optional(v.string())` to link form-type documents to their form builder equivalent

The field is optional to maintain backward compatibility with existing documents.
  </action>
  <verify>Run `cd app && npx convex dev --once` to verify schema compiles without errors</verify>
  <done>Documents table has contentType field with union type and by_contentType index</done>
</task>

<task type="auto">
  <name>Task 2: Create contentType mapping utility</name>
  <files>app/scripts/lib/contentTypeMapping.ts</files>
  <action>
Create a mapping utility based on CONTENT-TRACKER.md classifications:

1. Create `ContentType` type: `"procedure" | "reference" | "form" | "checklist" | "guide"`

2. Create `CONTENT_TYPE_MAP: Record<string, ContentType>` mapping source file paths to content types. Include ALL 70 documents from CONTENT-TRACKER.md:

**Procedures (10):**
- staff/procedures/closing-procedures -> procedure
- staff/procedures/service-protocols -> procedure
- staff/procedures/phone-system-guide -> procedure
- staff/training/training-manual -> procedure
- staff/training/training-program -> procedure
- staff/training/training-schedule -> procedure
- staff/training/sales-script -> procedure
- operations/facilities/maintenance-schedule -> procedure
- clients/planning/pre-wedding-todo -> procedure
- clients/day-of/wedding-processional -> procedure

**References (32):** All packages, menus, timelines, layouts, tracking sheets
- services/catering/catering-menu -> reference
- services/event-packages/* -> reference
- services/wedding-packages/* -> reference
- services/add-ons/* -> reference
- clients/booking/contract-package-shower -> reference
- clients/day-of/timeline-* -> reference
- clients/day-of/shoe-game-questions -> reference
- clients/day-of/quinceanera-processional -> reference
- clients/layouts/*/* -> reference (all layout files EXCEPT reset-checklist)
- operations/facilities/venue-layout -> reference
- operations/bar/alcohol-pull-tracker -> reference
- operations/catering/catering-sign-up -> reference
- services/catering/off-premise-menu -> reference

**Forms (18):** Booking forms, HR forms, planning forms - but these will be EXCLUDED
- clients/booking/booking-form-* -> form (REDUNDANT - exclude)
- staff/hr/hr-forms -> form (REDUNDANT - exclude)
- clients/day-of/music-list -> form (REDUNDANT - exclude)
- operations/forms/* -> form (REDUNDANT - exclude)
- clients/planning/bridal-planning-* -> form (REDUNDANT - exclude)
- clients/planning/micro-wedding-planning -> form (REDUNDANT - exclude)
- operations/bar/bar-event-list -> form (NOT redundant - keep)
- clients/layouts/hall/reset-checklist -> form (REDUNDANT - exclude)
- clients/layouts/saloon/reset-checklist -> form (REDUNDANT - exclude)

**Checklists (5):**
- clients/planning/checklist-* -> checklist
- deliverables/recipe-app/README -> checklist

**Guides (5):**
- clients/index -> guide
- services/index -> guide
- staff/index -> guide
- operations/index -> guide
- deliverables/index -> guide

3. Create `REDUNDANT_FORMS: Set<string>` listing paths to exclude from import (the 18 documents that have form builder equivalents):
- clients/booking/booking-form-wedding
- clients/booking/booking-form-corporate
- clients/booking/booking-form-shower
- staff/hr/hr-forms
- clients/day-of/music-list
- operations/forms/decor-appointment
- operations/forms/final-appointment
- operations/forms/vendor-setup
- operations/forms/tasting-form
- clients/planning/bridal-planning-2024
- clients/planning/micro-wedding-planning
- clients/planning/checklist-1-3-months (keep as checklist, not form)
- clients/planning/checklist-4-6-months (keep as checklist, not form)
- clients/planning/checklist-7-8-months (keep as checklist, not form)
- clients/planning/checklist-9-12-months (keep as checklist, not form)
- clients/layouts/hall/reset-checklist
- clients/layouts/saloon/reset-checklist

Wait - reviewing CONTENT-TRACKER more carefully: checklists (4 planning checklists + recipe-app) are NOT redundant. The redundant items are:
- 3 booking forms (markdown)
- 2 HR forms (in hr-forms.md)
- 4 operations forms (binary)
- 7 planning/checklist documents marked as forms (excluding the 4 planning checklists which are checklists, not forms)
- 2 reset checklists
- 1 music list
- 1 tasting form

So REDUNDANT_FORMS should be: booking-form-wedding, booking-form-corporate, booking-form-shower, hr-forms, music-list, decor-appointment, final-appointment, vendor-setup, tasting-form, reset-checklist (hall), reset-checklist (saloon), bridal-planning-2024, micro-wedding-planning = 13 items

Actually re-reading the cross-reference table, the 18 redundant items are the ones where form builder already has them.

4. Export `getContentType(path: string): ContentType | undefined` function that looks up the mapping.
  </action>
  <verify>Verify file exists and exports are typed correctly: `cd app && npx tsc --noEmit scripts/lib/contentTypeMapping.ts`</verify>
  <done>contentTypeMapping.ts exports ContentType, CONTENT_TYPE_MAP, REDUNDANT_FORMS, getContentType</done>
</task>

<task type="auto">
  <name>Task 3: Update import script to assign contentTypes and exclude redundant forms</name>
  <files>app/scripts/import-documents.ts</files>
  <action>
Modify import-documents.ts to:

1. Import from new mapping utility:
```typescript
import { getContentType, REDUNDANT_FORMS } from "./lib/contentTypeMapping";
```

2. In processDirectory function, after building the lookupKey, check if document should be excluded:
```typescript
// Check if this document is redundant (exists in form builder)
if (REDUNDANT_FORMS.has(lookupKey)) {
  console.log(`  ⊘ ${category}/${subPath}${entry.name} [REDUNDANT - skipped]`);
  skipped++;
  continue;
}
```

3. Determine contentType before calling create:
```typescript
const contentType = getContentType(lookupKey);
```

4. Add contentType to the create mutation call:
```typescript
await client.mutation(api.documents.create, {
  title,
  slug,
  category,
  subcategory,
  content,
  description,
  sourceFile: entry.name,
  sourceType: ext,
  contentType,  // Add this field
});
```

5. Update the console output to show content type:
```typescript
const typeTag = contentType ? `[${contentType}]` : "[untyped]";
console.log(`  ✓ ${category}/${subPath}${entry.name} ${sourceTag} ${typeTag}`);
```

6. Add counter for redundant skips and content type stats to final summary.
  </action>
  <verify>Run `cd app && npx tsc --noEmit scripts/import-documents.ts` to verify compilation</verify>
  <done>Import script assigns contentTypes from mapping and excludes redundant form documents</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd app && npx convex dev --once` succeeds (schema compiles)
- [ ] `cd app && npx tsc --noEmit` succeeds for modified files
- [ ] contentTypeMapping.ts has all 70 documents mapped
- [ ] REDUNDANT_FORMS contains correct 13-18 paths to exclude
</verification>

<success_criteria>
- Documents schema has contentType union field and by_contentType index
- contentTypeMapping.ts exists with complete mapping from CONTENT-TRACKER.md
- import-documents.ts assigns contentTypes and excludes redundant forms
- All TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/19-redundant-content-ia-redesign/19-01-SUMMARY.md`
</output>
