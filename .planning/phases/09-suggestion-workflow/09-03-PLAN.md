---
phase: 09-suggestion-workflow
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified: [app/src/components/SuggestionReview.tsx, app/src/components/SuggestionDiff.tsx, app/src/app/suggestions/review/page.tsx, app/src/app/suggestions/review/[id]/page.tsx, app/convex/suggestions.ts]
autonomous: false
---

<objective>
Create review workflow for managers/admins to approve or reject suggestions.

Purpose: Enable reviewers to see pending suggestions, compare proposed changes against current document, and promote approved changes to official documents.
Output: Review dashboard, diff view component, approve/reject UI, promotion mutation that applies changes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan provides API:
@.planning/phases/09-suggestion-workflow/09-01-SUMMARY.md

# Version comparison pattern from Phase 5:
@app/src/components/VersionCompare.tsx

# Document update with versioning:
@app/convex/documents.ts
@app/convex/versions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SuggestionDiff and SuggestionReview components</name>
  <files>app/src/components/SuggestionDiff.tsx, app/src/components/SuggestionReview.tsx</files>
  <action>
**SuggestionDiff.tsx:**
- Props: originalTitle, originalContent, suggestedTitle, suggestedContent
- Reuse diff display pattern from VersionCompare.tsx
- Show title change if different (highlighted)
- Line-by-line content diff: green additions, red deletions with strikethrough
- Scrollable container with max-height
- Monospace font for content comparison

**SuggestionReview.tsx:**
- Props: suggestionId
- Load suggestion with author info
- Display: author name, submitted date, change note
- Tabs or toggle: "View Suggestion" (rendered content) / "Compare to Current" (diff view)
- Review actions (only for managers/admins):
  - "Approve" button (opens confirm dialog with optional review note textarea)
  - "Reject" button (opens dialog requiring review note - must explain why)
- After approve: show "Apply Changes" button to promote to document
- State feedback: loading, success, error messages
  </action>
  <verify>npm run build succeeds, components render without errors</verify>
  <done>Diff component shows changes clearly, review component has full approve/reject flow</done>
</task>

<task type="auto">
  <name>Task 2: Create review pages and promotion mutation</name>
  <files>app/src/app/suggestions/review/page.tsx, app/src/app/suggestions/review/[id]/page.tsx, app/convex/suggestions.ts</files>
  <action>
**app/src/app/suggestions/review/page.tsx:**
- Protected page (redirect if not manager/admin)
- Title: "Pending Suggestions"
- List all pending suggestions with: document title, author, submitted date, change note preview
- Click to navigate to review detail
- Empty state: "No pending suggestions"
- Badge showing count of pending items

**app/src/app/suggestions/review/[id]/page.tsx:**
- Protected page (managers/admins only)
- Load suggestion by ID
- Render SuggestionReview component
- Breadcrumb: "Review > {document title}"
- Back link to review list

**Add to app/convex/suggestions.ts:**
- promote({ id }) mutation:
  - Verify suggestion is approved
  - Verify caller is manager/admin
  - Call documents.update with suggestion's title/content
  - changeNote: "Applied suggestion from {authorName}"
  - Mark suggestion with appliedAt timestamp (add field to schema if needed)
  - Return { success: true, documentId }

Note: promotion uses existing document update flow which auto-creates version snapshot.
  </action>
  <verify>npm run build succeeds, review flow works end-to-end</verify>
  <done>Review dashboard shows pending suggestions, reviewers can approve/reject, promotion applies changes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete suggestion workflow: create → submit → review → approve → promote</what-built>
  <how-to-verify>
    1. Run: npm run dev in app/
    2. Login as staff user
    3. Navigate to any document, click "Suggest Edit"
    4. Make changes, add change note, click "Submit for Review"
    5. Login as manager/admin
    6. Go to /suggestions/review
    7. Click pending suggestion, view diff
    8. Approve with review note
    9. Click "Apply Changes" to promote
    10. Visit original document - verify changes applied
    11. Check version history - should show suggestion attribution
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` in app/ succeeds
- [ ] Review dashboard shows pending suggestions
- [ ] Diff view clearly shows changes
- [ ] Approve/reject with review notes works
- [ ] Promotion applies changes to document with version tracking
- [ ] Permission checks: only managers/admins can review
</verification>

<success_criteria>

- Review pages created with proper permission gating
- Diff view shows clear comparison
- Approve/reject flow with required notes
- Promotion creates new document version with attribution
- Full workflow verified end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/09-suggestion-workflow/09-03-SUMMARY.md`
</output>
