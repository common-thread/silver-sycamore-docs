---
phase: 04-wiki-search-navigation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [app/src/components/CategoryGrid.tsx, app/convex/categories.ts, app/convex/subcategories.ts]
autonomous: true
---

<objective>
Enhance category navigation by pulling from Convex instead of hardcoded values.

Purpose: Dynamic category/subcategory navigation that can be managed in Convex.
Output: CategoryGrid pulling from database, subcategory queries.
</objective>

<context>
@.planning/PROJECT.md
@app/convex/schema.ts (has categories, subcategories tables)
@app/src/components/CategoryGrid.tsx (currently hardcoded)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add subcategories query</name>
  <files>app/convex/subcategories.ts</files>
  <action>
Create `convex/subcategories.ts`:

```typescript
import { query } from "./_generated/server";
import { v } from "convex/values";

// Get subcategories by category slug
export const byCategory = query({
  args: { categorySlug: v.string() },
  handler: async (ctx, args) => {
    const category = await ctx.db
      .query("categories")
      .withIndex("by_slug", (q) => q.eq("slug", args.categorySlug))
      .first();

    if (!category) return [];

    return await ctx.db
      .query("subcategories")
      .withIndex("by_category", (q) => q.eq("categoryId", category._id))
      .collect();
  },
});

// List all subcategories
export const list = query({
  handler: async (ctx) => {
    return await ctx.db.query("subcategories").collect();
  },
});
```
  </action>
  <verify>Subcategories query works</verify>
  <done>Subcategories queries created</done>
</task>

<task type="auto">
  <name>Task 2: Update CategoryGrid to use Convex</name>
  <files>app/src/components/CategoryGrid.tsx</files>
  <action>
Update CategoryGrid to:

1. Use `useQuery(api.categories.list)` for categories
2. Show loading state while fetching
3. Display dynamic category cards with name, description
4. Include document count per category (optional enhancement)
5. Maintain design system styling
  </action>
  <verify>CategoryGrid pulls from Convex</verify>
  <done>Dynamic CategoryGrid implemented</done>
</task>

<task type="auto">
  <name>Task 3: Create CategoryNav sidebar component</name>
  <files>app/src/components/CategoryNav.tsx</files>
  <action>
Create `src/components/CategoryNav.tsx`:

- Vertical list of categories with nested subcategories
- Collapsible sections
- Active state highlighting based on current route
- Can be used in category pages as sidebar
  </action>
  <verify>CategoryNav renders with expandable sections</verify>
  <done>CategoryNav sidebar created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] subcategories.ts queries working
- [ ] CategoryGrid pulls from Convex
- [ ] CategoryNav renders categories/subcategories
- [ ] Convex dev syncs
</verification>

<success_criteria>
- Categories and subcategories are database-driven
- Navigation reflects actual content structure
- Easy to add/modify categories in Convex dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/04-wiki-search-navigation/04-02-SUMMARY.md`
</output>
